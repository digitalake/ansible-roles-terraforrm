stages:
  - terraform

tf-validate:
  stage: terraform
  image:
    name: hashicorp/terraform
    pull_policy: if-not-present
    entrypoint: [""]
  tags:
    - docker
  script:
    - terraform fmt && terraform validate

tf-plan:
  stage: terraform
  needs: ["tf-validate"]
  image:
    name: hashicorp/terraform
    entrypoint: [""]
    pull_policy: if-not-present
  tags:
    - docker
  script:
    - terraform plan

tf-apply:
  stage: terraform
  needs: ["tf-plan"]
  image:
    name: hashicorp/terraform
    entrypoint: [""]
    pull_policy: if-not-present
  tags:
    - docker
  script:
    - terraform apply -auto-approve
